(this.webpackJsonpkiaragreen=this.webpackJsonpkiaragreen||[]).push([[0],{202:function(e,t,a){},203:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(75),s=a.n(r),i=a(5),l=a(17),o=a.n(l),h=a(76),u=a.n(h),d=(a(92),a(77)),j=a.n(d),b=window.cv,O=function(e,t,a,n,c,r,s,i,l,o){console.log("analyze");var h=e.getContext("2d"),u=n.current.getContext("2d"),d=h.getImageData(0,0,e.width,e.height),O=b.matFromImageData(d);console.log("image width: "+O.cols+"\nimage height: "+O.rows+"\nimage size: "+O.size().width+"*"+O.size().height+"\nimage depth: "+O.depth()+"\nimage channels "+O.channels()+"\nimage type: "+O.type()+"\n");new b.Mat;b.cvtColor(O,O,b.COLOR_RGBA2GRAY,0),"OTSU"===c?b.threshold(O,O,128,255,b.THRESH_BINARY+b.THRESH_OTSU):"ADAPTIVE"===c?(b.GaussianBlur(O,O,new b.Size(7,7),0),b.adaptiveThreshold(O,O,255,b.ADAPTIVE_THRESH_GAUSSIAN_C,b.THRESH_BINARY_INV,7,2)):b.threshold(O,O,c,255,b.THRESH_BINARY),b.morphologyEx(O,O,b.MORPH_OPEN,b.getStructuringElement(b.MORPH_ELLIPSE,new b.Size(r,r))),b.bitwise_not(O,O),b.morphologyEx(O,O,b.MORPH_OPEN,b.getStructuringElement(b.MORPH_ELLIPSE,new b.Size(i,i))),b.bitwise_not(O,O),b.dilate(O,O,b.getStructuringElement(b.MORPH_ELLIPSE,new b.Size(s,s))),b.bitwise_not(O,O);for(var g=u.getImageData(0,0,e.width,e.height),v=(g.width,g.height,0),m=0;m<g.height;m++)for(var x=0;x<g.width;x++){var f=4*v,p=g.data[f],S=g.data[f+1],N=g.data[f+2];v++,g.data[f+3]/255<.1||(O.ucharPtr(m,x)[0]=p,O.ucharPtr(m,x)[1]=S,O.ucharPtr(m,x)[2]=N,O.ucharPtr(m,x)[3]=255)}var C=new Map;if(l){for(var w=new b.Mat,E=new b.Mat,P=new b.Mat,T=b.connectedComponentsWithStats(O,w,E,P,4,b.CV_32S),y=1;y<T;y++){var R=E.intAt(y,b.CC_STAT_AREA);R>1e4&&(C.set(y,j()({format:"rgbArray"})),console.log(R))}console.log(C),b.cvtColor(O,O,b.COLOR_GRAY2RGB,0);for(var A=0;A<O.rows;A++)for(var I=0;I<O.cols;I++){var k=w.intAt(A,I);if(C.has(k)){var _=C.get(k);O.ucharPtr(A,I)[0]=_[0],O.ucharPtr(A,I)[1]=_[1],O.ucharPtr(A,I)[2]=_[2]}}}b.imshow("liveCanvas",O),o(!1),t({components:C.size})},g=function(e,t,a,c,r,s,i,l,o,h,d){var j=Object(n.useCallback)(u()(O,500),[]),b=Object(n.useRef)(null);return Object(n.useEffect)((function(){if(console.log("effect"),!e)return!1;d(!0);var n=new FileReader;n.addEventListener("loadend",(function(e){console.log("loadend",e);var n=new Image;n.onload=function(){if(!n)return!1;var e=b.current,h=c.current,u=e.getContext("2d");e.height=n.height,e.width=n.width,h.height=n.height,h.width=n.width,h.getContext("2d").clearRect(0,0,n.width,n.height),u.clearRect(0,0,n.width,n.height),console.log(e),u.drawImage(n,0,0),j(e,t,a,c,r,s,i,l,o,d)},n.src=e.target.result})),n.readAsDataURL(e)}),[e,t,a]),Object(n.useEffect)((function(){if(!e)return!1;d(!0);var n=b.current;j(n,t,a,c,r,s,i,l,o,d)}),[t,a,r,s,i,l,o,h,d]),b},v=a(12),m=a(3),x=function(e){var t=e.data,a=e.isLoading;return Object(m.jsx)("div",{className:"imageDataViewer"+(a?" loading":""),children:a?Object(m.jsx)(v.c,{}):Object.entries(t).map((function(e){var t=Object(i.a)(e,2),a=t[0],n=t[1];return Object(m.jsxs)("div",{className:"imageData",children:[Object(m.jsxs)("div",{className:"key",children:[a,":"]}),Object(m.jsx)("div",{className:"value",children:n})]},a)}))})},f=a(14),p=function(e){var t=e.Type,a=e.color,n=e.value,c=e.name,r=e.onChange,s=e.multiple;return Object(m.jsxs)("div",{className:"colorPicker",children:[Object(m.jsxs)("div",{className:"labelWrapper",children:[Object(m.jsx)("div",{className:"label",children:c}),Object(m.jsx)("div",{className:"value",children:"string"===typeof n?n:o()(n,s)})]}),Object(m.jsx)(t,{color:a,onChange:function(e,t){return r(e.hsl)}})]})},S=function(e){var t=e.mode,a=e.setLastChange,c=e.xref,r=e.lineWidth,s=Object(n.useState)(null),l=Object(i.a)(s,2),o=l[0],h=l[1],u=c.current,d=Object(n.useCallback)((function(e){h({x:e.clientX,y:e.clientY})}),[h]),j=Object(n.useCallback)((function(e){if(1===e.buttons&&o){var n=u.getContext("2d"),c=u.getBoundingClientRect(),s=u.width/c.width,i=u.height/c.height,l={x:(e.clientX-c.left)*s,y:(e.clientY-c.top)*i},d={x:(o.x-c.left)*s,y:(o.y-c.top)*i};n.beginPath(),n.lineWidth=r,n.lineCap="round","PAINT"===t?(n.globalCompositeOperation="source-over",n.strokeStyle="black"):(n.globalCompositeOperation="source-over",n.strokeStyle="white"),n.moveTo(d.x,d.y),n.lineTo(l.x,l.y),n.stroke(),h({x:e.clientX,y:e.clientY}),a((new Date).getTime())}}),[o,u,r,a,t]);return Object(m.jsx)("canvas",{onMouseDown:d,onMouseMove:j,className:"overlay canvas",ref:c})};var N=function(){var e=Object(n.useState)(null),t=Object(i.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)("PAINT"),s=Object(i.a)(r,2),l=s[0],h=s[1],u=Object(n.useState)(!1),d=Object(i.a)(u,2),j=d[0],b=d[1],O=Object(n.useState)(!1),N=Object(i.a)(O,2),C=N[0],w=N[1],E=Object(n.useState)("NONE"),P=Object(i.a)(E,2),T=P[0],y=P[1],R=Object(n.useState)({h:0,s:0,l:0,a:.1}),A=Object(i.a)(R,2),I=A[0],k=A[1],_=Object(n.useState)({h:0,s:0,l:0,a:1}),D=Object(i.a)(_,2),M=D[0],L=D[1],H=Object(n.useState)({h:0,s:0,l:0,a:.1}),z=Object(i.a)(H,2),B=z[0],W=z[1],Y=Object(n.useState)({h:0,s:0,l:0,a:.2}),G=Object(i.a)(Y,2),V=G[0],U=G[1],X=Object(n.useState)({h:0,s:0,l:0,a:.2}),F=Object(i.a)(X,2),J=F[0],Z=F[1],q=Object(n.useState)({}),K=Object(i.a)(q,2),Q=K[0],$=K[1],ee=Object(n.useRef)(null),te=Object(n.useRef)(null),ae=Object(n.useState)(0),ne=Object(i.a)(ae,2),ce=ne[0],re=ne[1],se=Math.round(255*M.a);255===se&&(se="OTSU"),0===se&&(se="ADAPTIVE");var ie=1|Math.ceil(30*B.a),le=1|Math.ceil(30*V.a),oe=1|Math.ceil(30*J.a),he=g(a,$,ee,te,se,ie,le,oe,C,ce,b),ue=Object(n.useState)(!1),de=Object(i.a)(ue,2),je=de[0],be=de[1],Oe=function(e){e.dataTransfer.dropEffect="copy",e.preventDefault()};return Object(m.jsxs)("div",{className:"root",onDragEnter:function(){return be(!0)},children:[Object(m.jsxs)("div",{className:"topPart",children:[Object(m.jsxs)("div",{className:"xWrapper",children:[Object(m.jsx)("div",{onClick:function(){return y("NONE")},className:"xPart"+("NONE"===T?" selected":""),children:Object(m.jsx)(v.d,{})}),Object(m.jsx)("div",{onClick:function(){return y("INSPECT")},className:"xPart"+("INSPECT"===T?" selected":""),children:Object(m.jsx)(v.b,{})}),Object(m.jsx)("div",{onClick:function(){return h("PAINT")},className:"xPart"+("PAINT"===l?" selected":""),children:Object(m.jsx)(v.e,{})}),Object(m.jsx)("div",{onClick:function(){return h("ERASE")},className:"xPart"+("ERASE"===l?" selected":""),children:Object(m.jsx)(v.a,{})})]}),Object(m.jsxs)("div",{className:"settingsWrapper",children:[Object(m.jsx)(p,{Type:f.a,color:I,multiple:1,value:100*I.a,name:"Line width",onChange:k}),Object(m.jsx)(p,{Type:f.a,color:M,multiple:.01,value:se,name:"Threshold",onChange:L}),Object(m.jsx)(p,{Type:f.a,color:B,multiple:.01,value:ie,name:"Morph",onChange:W}),Object(m.jsx)(p,{Type:f.a,color:J,multiple:.01,value:oe,name:"inv Morph",onChange:Z}),Object(m.jsx)(p,{Type:f.a,color:V,multiple:.01,value:le,name:"Dilate",onChange:U}),Object(m.jsxs)("label",{children:["Calculate Components:",Object(m.jsx)("input",{name:"isGoing",type:"checkbox",checked:C,onChange:function(e){var t=e.target;return w(t.checked)}})]})]}),Object(m.jsx)(x,{isLoading:j,data:Q})]}),Object(m.jsxs)("div",{className:"canvasWrapper",children:[Object(m.jsx)("div",{className:"canvas placeholder",children:Object(m.jsx)("div",{className:"placeholderText",children:"Drag image here"})}),Object(m.jsx)("canvas",{className:"canvas",ref:he}),Object(m.jsx)("canvas",{style:{pointerEvents:"none",display:"INSPECT"===T?"block":"none"},id:"liveCanvas",className:"overlay canvas",ref:ee}),Object(m.jsx)(S,{mode:l,lineWidth:o()(100*I.a),setLastChange:re,xref:te})]}),Object(m.jsx)("div",{style:{display:je?"block":"none"},className:"dropZone",onDragEnter:Oe,onDragOver:Oe,onDragLeave:function(){return be(!1)},onDrop:function(e){e.preventDefault(),be(!1),c(e.dataTransfer.files[0])}})]})};a(202);s.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(N,{})}),document.getElementById("root"))}},[[203,1,2]]]);
//# sourceMappingURL=main.cd37e501.chunk.js.map